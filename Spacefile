# Spacefile Docs: https://go.deta.dev/docs/spacefile/v0
v: 0
micros:
  - name: api
    src: .
    engine: python3.9
    primary: true
    path: "/"
    include:
      - api/
      - cli/
      - services/
      - templates/
      - errors.py
      - main.py
      - manage.py
      - settings.py
      - prod-requirements.txt
    public_routes:
      - "/*"
    run: pip install -r prod-requirements.txt && uvicorn main:app --port $PORT
    dev: pip install -r prod-requirements.txt && uvicorn main:app --port $PORT --reload
    presets:
      env:
        - name: DB_PATH
          description: path to the scdb database folder
          default: "./db"
        - name: MAX_HYMNS
          description: maximum number of hymns to house in app
          default: 2000000
        - name: DB_REDUNDANCY_BLOCKS
          description: number of redundant buffer blocks for extra keys in scdb
          default: 2
        - name: DB_BUFFER_POOL_CAPACITY
          description: scdb number of memory buffers
          default: 5
        - name: DB_COMPACTION_INTERVAL
          description: scdb interval in seconds for compacting/defragmenting database files
          default: 3600
        - name: LANGUAGES
          description: comma-separated list of languages that the song bank will have
          default: "english,runyoro"
        - name: API_KEY_LENGTH
          description: the length of the API keys generated
          default: 32
        - name: RATE_LIMIT
          description: the maximum number of requests per window (e.g. second) allowed from one IP address
          default: "5/minute"
        - name: OTP_VERIFICATION_URL
          description: the url where the one-time password (OTP) are to be verified from
        - name: API_SECRET
          description: the 32-byte API secret for hashing and encrypting stuff in the API
        - name: JWT_TTL_SECONDS
          description: the JWT token's time-to-live in seconds
          default: 900
        - name: ENABLE_RATE_LIMIT
          description: the flag for enabling/disabling rate-limiting
          default: "true"
        - name: MAX_LOGIN_ATTEMPTS
          description: maximum number of attempts to feed in an OTP before being locked out.
          default: 5
        - name: AUTH_MAIL_SENDER
          description: name of the person to put as email sender for all auth related emails
          default: "Hymns API team"
        - name: MAIL_USERNAME
          description: SMTP username
        - name: MAIL_PASSWORD
          description: SMTP password
        - name: MAIL_PORT
          description: SMTP port
        - name: MAIL_SERVER
          description: SMTP mail server
        - name: MAIL_FROM
          description: Sender address
        - name: MAIL_STARTTLS
          description: For STARTTLS connections
          default: "true"
        - name: MAIL_SSL_TLS
          description: For connecting over TLS/SSL
          default: "false"
        - name: MAIL_DEBUG
          description: SMTP mail debug i.e. whether mail is being debugged or not. Useful during development.
          default: 0
        - name: MAIL_FROM_NAME
          description: Title for Mail
        - name: MAIL_SUPPRESS_SEND
          description: whether sending of emails should be suppressed
          default: 0
        - name: MAIL_USE_CREDENTIALS
          description: whether or not to login to their SMTP server.
          default: "true"
        - name: MAIL_VALIDATE_CERTS
          description: whether to verify the mail server's certificate
          default: "true"
        - name: MAIL_TIMEOUT
          description: timeout in seconds when sending emails
          default: 60
